<div class="product-detail-container">
  <a href="/products" class="back-link">← Volver a productos</a>

  {{#if product}}
    <div class="product-detail">
      <div class="product-images">
        {{#if product.thumbnails}}
          {{#each product.thumbnails}}
            <img src="/api/images/{{../id}}/{{@index}}" alt="{{../title}}" class="product-detail-image">
          {{/each}}
        {{else}}
          <div class="product-image-placeholder large">Sin imagen</div>
        {{/if}}
      </div>

      <div class="product-info">
        <h1>{{product.title}}</h1>
        <p class="product-description">{{product.description}}</p>
        
        <div class="product-details">
          <p class="product-price-large">${{product.price}}</p>
          <p><strong>Stock disponible:</strong> {{product.stock}}</p>
          <p><strong>Categoría:</strong> {{product.category}}</p>
          <p><strong>Estado:</strong> 
            {{#if product.status}}
              <span class="status-available">Disponible</span>
            {{else}}
              <span class="status-unavailable">No disponible</span>
            {{/if}}
          </p>
          <p><strong>Código:</strong> {{product.code}}</p>
        </div>

        <div class="product-actions">
          <button onclick="addToCart('{{product.id}}')" class="btn btn-success btn-large" {{#unless product.status}}disabled{{/unless}}>
            Agregar al Carrito
          </button>
        </div>
      </div>
    </div>
  {{else}}
    <div class="error-message">
      <p>Producto no encontrado</p>
    </div>
  {{/if}}
</div>

<script>
  async function addToCart(productId) {
    try {
      // Crear o obtener carrito
      const createCartResponse = await fetch('/api/carts', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      const cart = await createCartResponse.json();
      
      // Agregar producto al carrito
      const addResponse = await fetch(`/api/carts/${cart.id}/product/${productId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ quantity: 1 })
      });

      if (addResponse.ok) {
        alert('Producto agregado al carrito!');
        window.location.href = `/carts/${cart.id}`;
      } else {
        alert('Error al agregar producto al carrito');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error al agregar producto al carrito');
    }
  }
</script>

